<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Clean code, Horrible Performance | tech support wiki</title>
    <meta name="description" content="A VitePress site">
    <meta name="generator" content="VitePress v1.0.0-rc.39">
    <link rel="preload stylesheet" href="/tech-support-wiki/assets/style.cnmgQSgJ.css" as="style">
    
    <script type="module" src="/tech-support-wiki/assets/app.ioQMt7py.js"></script>
    <link rel="preload" href="/tech-support-wiki/assets/inter-roman-latin.bvIUbFQP.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/tech-support-wiki/assets/chunks/framework.WP9juYLV.js">
    <link rel="modulepreload" href="/tech-support-wiki/assets/chunks/theme.5W2qzdAj.js">
    <link rel="modulepreload" href="/tech-support-wiki/assets/chunks/Youtube.KWhjJMtp.js">
    <link rel="modulepreload" href="/tech-support-wiki/assets/general_clean-code-horrible-performance.md.ptk3eKKK.lean.js">
    <link rel="icon" href="/tech-support-wiki/favicon.svg" type="image/svg+xml">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d5352887><!--[--><!--]--><!--[--><span tabindex="-1" data-v-3b43872f></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-3b43872f> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d5352887 data-v-771f16ad><div class="VPNavBar has-sidebar" data-v-771f16ad data-v-f30707ed><div class="wrapper" data-v-f30707ed><div class="container" data-v-f30707ed><div class="title" data-v-f30707ed><div class="VPNavBarTitle has-sidebar" data-v-f30707ed data-v-90ba4ce5><a class="title" href="/tech-support-wiki/" data-v-90ba4ce5><!--[--><!--]--><!----><!--[-->tech support wiki<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-f30707ed><div class="content-body" data-v-f30707ed><!--[--><!--]--><div class="VPNavBarSearch search" data-v-f30707ed><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-f30707ed data-v-a80c6bb3><span id="main-nav-aria-label" class="visually-hidden" data-v-a80c6bb3>Main Navigation</span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/KraXen72/tech-support-wiki" target="_blank" rel="noreferrer" tabindex="0" data-v-a80c6bb3 data-v-033d9637><!--[--><span data-v-033d9637>GitHub</span><!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://ko-fi.com/kraxen72" target="_blank" rel="noreferrer" tabindex="0" data-v-a80c6bb3 data-v-033d9637><!--[--><span data-v-033d9637>Ko-fi</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-f30707ed data-v-d2835559><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d2835559 data-v-01984aec data-v-fa532ba1><span class="check" data-v-fa532ba1><span class="icon" data-v-fa532ba1><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-01984aec><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-01984aec><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><!----><div class="VPFlyout VPNavBarExtra extra" data-v-f30707ed data-v-612b0cfe data-v-5361aa0f><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-5361aa0f><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-5361aa0f><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-5361aa0f><div class="VPMenu" data-v-5361aa0f data-v-a7b52136><!----><!--[--><!--[--><!----><div class="group" data-v-612b0cfe><div class="item appearance" data-v-612b0cfe><p class="label" data-v-612b0cfe>Appearance</p><div class="appearance-action" data-v-612b0cfe><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-612b0cfe data-v-01984aec data-v-fa532ba1><span class="check" data-v-fa532ba1><span class="icon" data-v-fa532ba1><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-01984aec><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-01984aec><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><!----><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-f30707ed data-v-063bb365><span class="container" data-v-063bb365><span class="top" data-v-063bb365></span><span class="middle" data-v-063bb365></span><span class="bottom" data-v-063bb365></span></span></button></div></div></div></div><div class="divider" data-v-f30707ed><div class="divider-line" data-v-f30707ed></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d5352887 data-v-b08d48e2><div class="container" data-v-b08d48e2><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-b08d48e2><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-b08d48e2><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-b08d48e2>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-b08d48e2 data-v-bc7d399c><button data-v-bc7d399c>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d5352887 data-v-fea07bb2><div class="curtain" data-v-fea07bb2></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-fea07bb2><span class="visually-hidden" id="sidebar-aria-label" data-v-fea07bb2> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>electron</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/electron/electron-preload-to-renderer.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>electron preload to renderer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/electron/electron-reloader-ignore-files.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>electron reloader ignore files</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/electron/typescript-get-intelliSense-for-contextBridge-api.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>typescript get intelliSense for contextBridge api</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0 has-active" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>general</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/general/clean-code-horrible-performance.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>clean code horrible performance</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/general/how-to-print-2-of-the-same-page-on-1-page.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>how to print 2 of the same page on 1 page</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/general/How-to-Tile-an-Image-in-GIMP.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>How to Tile an Image in GIMP</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/general/vivaldi-is-dimmer-when-unfocused.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>vivaldi is dimmer when unfocused</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>git</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/git/set-up-git-submodules.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>set up git submodules</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/git/set-up-multiple-accounts-with-ssh-windows.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>set up multiple accounts with ssh windows</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>javascript</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/javascript/js-download-txt-filre.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>js download txt filre</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/javascript/js-locale-aware-array-sort.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>js locale aware array sort</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/javascript/js-method-chaining.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>js method chaining</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/javascript/js-ts-add-function-to-object.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>js ts add function to object</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>nodejs</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/nodejs/esm-and-cjs-co-existence.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>esm and cjs co existence</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/nodejs/pnpm-link.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>pnpm link</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>qmk</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/qmk/how-to-update-qmk.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>how to update qmk</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>regex</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/regex/fixed-length-palindrome.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>fixed length palindrome</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/regex/ISO-date-groups.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>ISO date groups</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>svelte vite</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/svelte%20vite/svelte+vite-$lib-alias.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>svelte+vite $lib alias</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/svelte%20vite/svelte-+-vite-publish-to-github-pages.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>svelte + vite publish to github pages</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/svelte%20vite/svelte-and-vite-template.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>svelte and vite template</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/svelte%20vite/svelte-each-block-but-you-care-about-key-of-object.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>svelte each block but you care about key of object</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/svelte%20vite/vite-failing-to-load-bundles.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>vite failing to load bundles</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>typescript</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/typescript/type-a-function-with-an-interface.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>type a function with an interface</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/typescript/typescript-how-to-ignore-stuff.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>typescript how to ignore stuff</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/typescript/typescript-thinks-svelte-is-jsx.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>typescript thinks svelte is jsx</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/typescript/when-to-use-Record-in-typescript.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>when to use Record in typescript</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>vs code</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/vs%20code/gitlens-turn-off-button-in-tabbar-toolbar.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>gitlens turn off button in tabbar toolbar</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>webdev</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/webdev/convert-images-fonts-into-raw-css-data.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>convert images fonts into raw css data</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/webdev/html-css-site-makes-text-smaller-on-mobile.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>html css site makes text smaller on mobile</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/webdev/tailwind-windows-no-bundler.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>tailwind windows no bundler</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-fea07bb2><section class="VPSidebarItem level-0" data-v-fea07bb2 data-v-d9e64a71><div class="item" role="button" tabindex="0" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><h2 class="text" data-v-d9e64a71>windows</h2><!----></div><div class="items" data-v-d9e64a71><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/windows/How%20to%20change%20the%20keyboard%20language%20shortcut%20in%20Windows%2010.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>How to change the keyboard language shortcut in Windows 10</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d9e64a71 data-v-d9e64a71><div class="item" data-v-d9e64a71><div class="indicator" data-v-d9e64a71></div><a class="VPLink link link" href="/tech-support-wiki/windows/windows-autochecking-disk-on-startup.html" data-v-d9e64a71><!--[--><p class="text" data-v-d9e64a71>windows autochecking disk on startup</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d5352887 data-v-8f41dd96><div class="VPDoc has-sidebar has-aside" data-v-8f41dd96 data-v-bae9d5c7><!--[--><!--]--><div class="container" data-v-bae9d5c7><div class="aside" data-v-bae9d5c7><div class="aside-curtain" data-v-bae9d5c7></div><div class="aside-container" data-v-bae9d5c7><div class="aside-content" data-v-bae9d5c7><div class="VPDocAside" data-v-bae9d5c7 data-v-8b0629df><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" role="navigation" data-v-8b0629df data-v-e48f3a84><div class="content" data-v-e48f3a84><div class="outline-marker" data-v-e48f3a84></div><div class="outline-title" role="heading" aria-level="2" data-v-e48f3a84>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-e48f3a84><span class="visually-hidden" id="doc-outline-aria-label" data-v-e48f3a84> Table of Contents for current page </span><ul class="VPDocOutlineItem root" data-v-e48f3a84 data-v-8e1002c7><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-8b0629df></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-bae9d5c7><div class="content-container" data-v-bae9d5c7><!--[--><!--]--><main class="main" data-v-bae9d5c7><div style="position:relative;" class="vp-doc _tech-support-wiki_general_clean-code-horrible-performance" data-v-bae9d5c7><div><h1 id="clean-code-horrible-performance-by-casey-muratori" tabindex="-1">&quot;Clean&quot; Code, Horrible Performance - by Casey Muratori <a class="header-anchor" href="#clean-code-horrible-performance-by-casey-muratori" aria-label="Permalink to &quot;&quot;Clean&quot; Code, Horrible Performance - by Casey Muratori&quot;">​</a></h1><p>source: <a href="https://www.computerenhance.com/p/clean-code-horrible-performance" target="_blank" rel="noreferrer">https://www.computerenhance.com/p/clean-code-horrible-performance</a> this is a really interesting read that has been temporarily put here until i find a better solution to link &amp; preserve blog posts like this</p><blockquote><p>Many programming &quot;best practices&quot; taught today are performance disasters waiting to happen.</p></blockquote><div class="youtube-embed" data-v-0611a4b9><iframe src="https://www.youtube-nocookie.com/embed/tD5NrevFtbU?rel=0&amp;amp;autoplay=0&amp;amp;showinfo=0&amp;amp;enablejsapi=0" frameborder="0" loading="lazy" gesture="media" allow="autoplay; fullscreen" allowautoplay="true" allowfullscreen="true" style="width:100%;height:auto;aspect-ratio:16/9;" data-v-0611a4b9></iframe></div><p><em>This is a free bonus video from the Performance-Aware Programming series. It shows the real-world performance costs of following “clean code” guidelines. For more information about the course, please see the <a href="https://www.computerenhance.com/about" target="_blank" rel="noreferrer">About</a> page or the <a href="https://www.computerenhance.com/p/table-of-contents" target="_blank" rel="noreferrer">Table of Contents</a>.</em></p><p><em>A lightly-edited transcript of the video appears below.</em></p><p>Some of the most-often repeated programming advice, especially to beginner programmers, is that they should be writing “clean” code. That moniker is accompanied by a long list of rules that tell you what you should do in order for your code to be “clean”.</p><p>A large portion of these rules don&#39;t actually affect the runtime of the code that you write. These sorts of rules cannot be objectively assessed, and we don&#39;t necessarily have to because they&#39;re fairly arbitrary at that point. However, several “clean” code rules — some of the ones most emphatically stressed — are things we <em>can</em> objectively measure because they <em>do</em> affect the runtime behavior of the code.</p><p>If you look at a “clean” code summary and pull out the rules that actually affect the structure of your code, you get:</p><ul><li>Prefer polymorphism to “if/else” and “switch”</li><li>Code should not know about the internals of objects it’s working with</li><li>Functions should be small</li><li>Functions should do one thing</li><li>“DRY” - Don’t Repeat Yourself</li></ul><p>These rules are rather specific about how any particular piece of code should be created in order for it to be “clean”. What I would like to ask is, if we create a piece of code that follows these rules, how does it perform?</p><p>In order to construct what I would consider the most favorable case for a “clean” code implementation of something, I used existing example code contained in “clean” code literature. This way, I am not making anything up, I’m just assessing “clean” code advocates’ rules using the example code they give to illustrate those rules.</p><p>If you look at “clean” code examples, you&#39;ll often see an example like this:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 22</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    shape_base() {}</span></span>
<span class="line"><span>    virtual f32 Area() = 0;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class square : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    square(f32 SideInit) : Side(SideInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return Side*Side;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Side;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class rectangle : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    rectangle(f32 WidthInit, f32 HeightInit) : Width(WidthInit), Height(HeightInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return Width*Height;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Width, Height;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class triangle : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    triangle(f32 BaseInit, f32 HeightInit) : Base(BaseInit), Height(HeightInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return 0.5f*Base*Height;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Base, Height;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class circle : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    circle(f32 RadiusInit) : Radius(RadiusInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return Pi32*Radius*Radius;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Radius;</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>It’s a base class for a shape with a few specific shapes derived from it: circle, triangle, rectangle, square. We then have a virtual function that computes the area.</p><p>Like the rules demand, we are preferring polymorphism. Our functions do only one thing. They are small. All that good stuff. So we end up with a “clean” class hierarchy, with each derived class knowing how to compute its own area, and storing the data required to compute that area.</p><p>If we image using this hierarchy to do something — say, finding the total area of a series of shapes that we pass in — we would expect to see something like this:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 23</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 TotalAreaVTBL(u32 ShapeCount, shape_base **Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum = 0.0f;</span></span>
<span class="line"><span>    for(u32 ShapeIndex = 0; ShapeIndex &lt; ShapeCount; ++ShapeIndex)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum += Shapes[ShapeIndex]-&gt;Area();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    return Accum;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>You&#39;ll notice I haven&#39;t used an iterator here because there was nothing in the rules that suggested you had to use iterators. As such, I figured I would give “clean” code the benefit of the doubt and not add any kind of abstracted iterator that might confuse the compiler and lead to worse performance.</p><p>You may also notice that this loop is over an array of <em>pointers</em>. This is a direct consequence of using a class hierarchy: we have no idea how big in memory each of these shapes might be. So unless we were going to add another virtual function call to get the data size of each shape, and use some kind of a variable skipping procedure to go through them, we need pointers to find out where each shape actually begins.</p><p>Because this is an accumulation, there&#39;s a loop-carried dependency here which might slow the loop down. Since accumulation can be reordered arbitrarily, I also wrote a hand-unrolled version just to be safe:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 24</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 TotalAreaVTBL4(u32 ShapeCount, shape_base **Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum0 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum1 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum2 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum3 = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    u32 Count = ShapeCount/4;</span></span>
<span class="line"><span>    while(Count--)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum0 += Shapes[0]-&gt;Area();</span></span>
<span class="line"><span>        Accum1 += Shapes[1]-&gt;Area();</span></span>
<span class="line"><span>        Accum2 += Shapes[2]-&gt;Area();</span></span>
<span class="line"><span>        Accum3 += Shapes[3]-&gt;Area();</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        Shapes += 4;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    f32 Result = (Accum0 + Accum1 + Accum2 + Accum3);</span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>If I run these two routines in a simple test harness, I can get a rough measure of the total number of cycles per shape that are required to do that operation:</p><p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fdd6e15d8-0cfa-4215-9ac9-5930c52c0c7e_1920x1080.png" alt=""></p><p>The harness times the code in two different ways. The first way is running the code only once, to show what happens in an arbitrary “cold” state — the data should be in L3 but L2 and L1 have been flushed, and the branch predictor has not “practiced” on the loop.</p><p>The second way is running the code many times repeatedly, to see what happens when the cache and branch predictor are operating in their most favorable way for the loop. Note that none of these are hard-core measurements, because as you’ll see, the differences we’ll be looking at are so large that we don’t need to break out any serious analysis tools.</p><p>What we can see from the results is there&#39;s not much of a difference between the two routines. It&#39;s around 35 cycles to do the “clean” code area calculation on a shape. Maybe it gets down more towards 34 sometimes if you&#39;re really lucky.</p><p>So 35 cycles is what we can expect from following all the rules. What would happen if instead we violated <em>just</em> the first rule? Instead of using polymorphism here, what if we just use a switch statement instead</p><p>?</p><p>Here I&#39;ve written the exact same code, but instead of writing it using a class hierarchy (and therefore, at runtime, a vtable), I&#39;ve written it using an enum and a shape type that flattens everything into one struct:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 25</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>enum shape_type : u32</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    Shape_Square,</span></span>
<span class="line"><span>    Shape_Rectangle,</span></span>
<span class="line"><span>    Shape_Triangle,</span></span>
<span class="line"><span>    Shape_Circle,</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    Shape_Count,</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>struct shape_union</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    shape_type Type;</span></span>
<span class="line"><span>    f32 Width;</span></span>
<span class="line"><span>    f32 Height;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 GetAreaSwitch(shape_union Shape)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Result = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    switch(Shape.Type)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        case Shape_Square: {Result = Shape.Width*Shape.Width;} break;</span></span>
<span class="line"><span>        case Shape_Rectangle: {Result = Shape.Width*Shape.Height;} break;</span></span>
<span class="line"><span>        case Shape_Triangle: {Result = 0.5f*Shape.Width*Shape.Height;} break;</span></span>
<span class="line"><span>        case Shape_Circle: {Result = Pi32*Shape.Width*Shape.Width;} break;</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        case Shape_Count: {} break;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>This is the “old school” way you would have written this before “clean” code.</p><p>Note that because we no longer have specific datatypes for every shape variant, if a type doesn’t have one of the values in question (like “height”, for example), it simply doesn’t use it.</p><p>Now, instead of getting the area from a virtual function call, a user of this struct gets it from a function with a switch statement: exactly the thing that a “clean” code lecture would tell you to <em>never</em> <em>ever do</em>. Even so, you’ll note that the code, despite being much more concise, is basically the same. Each case of the switch statement is just the same code as the corresponding virtual function in the class hierarchy.</p><p>For the summation loops themselves, you can see that they are nearly identical to the “clean” version:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 26</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 TotalAreaSwitch(u32 ShapeCount, shape_union *Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    for(u32 ShapeIndex = 0; ShapeIndex &lt; ShapeCount; ++ShapeIndex)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum += GetAreaSwitch(Shapes[ShapeIndex]);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return Accum;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 TotalAreaSwitch4(u32 ShapeCount, shape_union *Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum0 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum1 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum2 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum3 = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    ShapeCount /= 4;</span></span>
<span class="line"><span>    while(ShapeCount--)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum0 += GetAreaSwitch(Shapes[0]);</span></span>
<span class="line"><span>        Accum1 += GetAreaSwitch(Shapes[1]);</span></span>
<span class="line"><span>        Accum2 += GetAreaSwitch(Shapes[2]);</span></span>
<span class="line"><span>        Accum3 += GetAreaSwitch(Shapes[3]);</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        Shapes += 4;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    f32 Result = (Accum0 + Accum1 + Accum2 + Accum3);</span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>The only difference is that instead of calling a member function to get the area, we call a regular function. That’ sit.</p><p>However, you can already see an immediate benefit from using the flattened structure as compare to a class hierarchy: the shapes can just be in an array, no pointers necessary. There is no indirection because we’ve made all our shapes the same size.</p><p>Plus, we get the added benefit that the compiler can now see <em>exactly</em> what we&#39;re doing in this loop, because it can just look at the <em>GetAreaSwitch</em> function and see the entire codepath. It doesn’t have to assume that <em>anything</em> might happen in some virtualized area function only known at run-time.</p><p>So with those benefits, what can the compiler do for us? If I run all four together now, these are the results:</p><p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F229bd86c-3578-4f2a-94d1-2085e13da44a_1920x1080.png" alt=""></p><p>When we look at the results, we see something rather remarkable: just that one change — writing the code the old fashioned way rather than the “clean” code way — gave us an immediate 1.5x performance increase. That’s a free 1.5x for not doing anything other than removing the extraneous stuff required to use C++ polymorphism.</p><p>So by violating the first rule of clean code — which is one of its central tenants — we are able to drop from 35 cycles per shape to 24 cycles per shape, impling that code following that rule number is 1.5x <em>slower</em> than code that doesn’t. To put that in in hardware terms, it would be like taking an iPhone 14 Pro Max and reducing it to an iPhone 11 Pro Max. It&#39;s three or four years of hardware evolution <em>erased</em> because somebody said to use polymorphism instead of switch statements.</p><p>But we&#39;re only just getting started.</p><p>What if we broke <em>more</em> rules? What if we also broke the second rule, “no internal knowledge”? What if our functions <em>could</em> use knowledge of what they were actually operating on to make themselves more efficient?</p><p>If you look back at the get area switch statement, one of the things you can see is that all the area computations are <em>similar</em>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>        case Shape_Square: {Result = Shape.Width*Shape.Width;} break;</span></span>
<span class="line"><span>        case Shape_Rectangle: {Result = Shape.Width*Shape.Height;} break;</span></span>
<span class="line"><span>        case Shape_Triangle: {Result = 0.5f*Shape.Width*Shape.Height;} break;</span></span>
<span class="line"><span>        case Shape_Circle: {Result = Pi32*Shape.Width*Shape.Width;} break;</span></span></code></pre></div><p>They all do something like width times height, or width times width, optionally with a coefficient like π. and then they&#39;re gonna multiply by half in the case of a triangle or pie in the case of a circle, something like this.</p><p>This is actually one of the reasons that — unlike “clean” code advocates — I think switch statements are great! They make this kind of pattern <em>very easy to see</em>. When your code is organized by <em>operation</em>, rather than by <em>type</em>, it’s straightforward to observe and pull out common patterns. By contrast, if you were to look back at the class version, you would probably never notice this kind of pattern because not only is there a lot more boilerplate in the way, but “clean” code advocates recommend putting each class <em>in a separate file</em>, making it <em>even less likely</em> you’ll ever notice something like this.</p><p>So architecturally I disagree with class hierarchies in general, but that&#39;s beside the point. The only point I really want to make right now is that we can simplify this switch statement quite a bit by noticing the pattern.</p><p>And remember: this is not an example that I picked! This is the example that clean code advocates themselves use for illustrative purposes. So I didn’t intentionally pick an example where you happen to be able to pull out a pattern — it’s just <em>very likely</em> that you can do this, because most things of similar type have similar algorithmic structure, so as expected, it happens here.</p><p>To exploit this pattern, we can introduce a simple table that says what the coefficient is that we need to use for each type. If we then make our single-parameter types like circle and square <em>duplicate</em> their width into their height, we can make a <em>dramatically</em> simpler function for area:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 27</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 const CTable[Shape_Count] = {1.0f, 1.0f, 0.5f, Pi32};</span></span>
<span class="line"><span>f32 GetAreaUnion(shape_union Shape)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Result = CTable[Shape.Type]*Shape.Width*Shape.Height;</span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>The two summation loops for this version are exactly the same — they don’t have to be changed, they can just call <em>GetAreaUnion</em> instead of <em>GetAreaSwitch</em>, and be otherwise identical.</p><p>Let&#39;s see what happens if we run this new version against our previous loops:</p><p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fd9729482-f173-4f47-a8b8-7def1d09395f_1920x1080.png" alt=""></p><p>What you can see here is that by taking advantage of what we know about the actual types we have — effectively switching from a <em>type</em>-based mindset to a <em>function</em>-based mindset — we get a <em>massive</em> speed increase. We&#39;ve gone from a switch statement that was merely 1.5x faster to a table-driven version that’s fully <em>10x faster</em> or more on the exact same problem.</p><p>And to do this, we used nothing other than one table lookup and a single line of code! It’s not only much <em>faster</em>, it’s also <em>much less semantically complex</em>. It’s less tokens, less operations, less lines of code.</p><p>So by fusing our data model with our desired operation, rather than demanding that the operation not know the internals, we got all the way down to the 3.0-3.5 cycles per shape range. That&#39;s a <em>10x</em> speed improvement over the “clean” code version that follows the first two rules.</p><p>10x is so large a performance increase, it&#39;s not even possible to put it in iPhone terms because iPhone benchmarks don&#39;t go back far enough. If I went all the way back to the iPhone 6, which is the oldest phone still showing up on modern benchmarks, it&#39;s only about three times slower than the iPhone 14 Pro Max. So we can&#39;t even use phones anymore to describe this difference.</p><p>If we were to look at single-thread desktop performance, a 10x speed improvement is like going from the average <a href="https://www.cpubenchmark.net/year-on-year.html" target="_blank" rel="noreferrer">CPU mark</a> today all the way back to the average CPU mark from 2010! The first two rules of the “clean code” concept wipe out <em>12 years</em> of hardware evolution, all by themselves.</p><p>But as shocking as that is, this test if only doing a very simple operation. We’re not really using “functions should be small” and “functions should do only one thing” much, because we only have one very simple thing to do in the first place. What if we <em>add</em> another aspect to our problem so that we can follow those rules more directly?</p><p>Here I have written the exact same hierarchy that we had before, but this time I’ve added one more virtual function which tells us the number of corners each shape has:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 32</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    shape_base() {}</span></span>
<span class="line"><span>    virtual f32 Area() = 0;</span></span>
<span class="line"><span>    virtual u32 CornerCount() = 0;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class square : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    square(f32 SideInit) : Side(SideInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return Side*Side;}</span></span>
<span class="line"><span>    virtual u32 CornerCount() {return 4;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Side;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class rectangle : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    rectangle(f32 WidthInit, f32 HeightInit) : Width(WidthInit), Height(HeightInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return Width*Height;}</span></span>
<span class="line"><span>    virtual u32 CornerCount() {return 4;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Width, Height;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class triangle : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    triangle(f32 BaseInit, f32 HeightInit) : Base(BaseInit), Height(HeightInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return 0.5f*Base*Height;}</span></span>
<span class="line"><span>    virtual u32 CornerCount() {return 3;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Base, Height;</span></span>
<span class="line"><span>};</span></span>
<span class="line"><span></span></span>
<span class="line"><span>class circle : public shape_base</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>public:</span></span>
<span class="line"><span>    circle(f32 RadiusInit) : Radius(RadiusInit) {}</span></span>
<span class="line"><span>    virtual f32 Area() {return Pi32*Radius*Radius;}</span></span>
<span class="line"><span>    virtual u32 CornerCount() {return 0;}</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>private:</span></span>
<span class="line"><span>    f32 Radius;</span></span>
<span class="line"><span>};</span></span></code></pre></div><p>A rectangle has four corners, a triangle has three, a circle has none, etc. I&#39;m then going to change the definition of the problem from computing the sum of the <em>areas</em> of a series of shapes, to computing the sum of the <em>corner-weighted</em> areas, which I’m going to define as one over one plus the number of corners.</p><p>Much like the area summation, there&#39;s no reason for this, I’m just trying to work within the example. I added the simplest possible thing I could think of, then did some very basic math on it.</p><p>To update the “clean” summation loop, we add the necessary math and the additional virtual function call:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>f32 CornerAreaVTBL(u32 ShapeCount, shape_base **Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum = 0.0f;</span></span>
<span class="line"><span>    for(u32 ShapeIndex = 0; ShapeIndex &lt; ShapeCount; ++ShapeIndex)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum += (1.0f / (1.0f + (f32)Shapes[ShapeIndex]-&gt;CornerCount())) * Shapes[ShapeIndex]-&gt;Area();</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    return Accum;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 CornerAreaVTBL4(u32 ShapeCount, shape_base **Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum0 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum1 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum2 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum3 = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    u32 Count = ShapeCount/4;</span></span>
<span class="line"><span>    while(Count--)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum0 += (1.0f / (1.0f + (f32)Shapes[0]-&gt;CornerCount())) * Shapes[0]-&gt;Area();</span></span>
<span class="line"><span>        Accum1 += (1.0f / (1.0f + (f32)Shapes[1]-&gt;CornerCount())) * Shapes[1]-&gt;Area();</span></span>
<span class="line"><span>        Accum2 += (1.0f / (1.0f + (f32)Shapes[2]-&gt;CornerCount())) * Shapes[2]-&gt;Area();</span></span>
<span class="line"><span>        Accum3 += (1.0f / (1.0f + (f32)Shapes[3]-&gt;CornerCount())) * Shapes[3]-&gt;Area();</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        Shapes += 4;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    f32 Result = (Accum0 + Accum1 + Accum2 + Accum3);</span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>I <em>could</em> argue that I should pull this out into <em>another</em> function, adding <em>yet another</em> layer of indirection. But again, to give the “clean” code the benefit of the doubt, I will leave it explicitly in there.</p><p>To update the switch-statement version, we make essentially the same changes. First, we add another switch statement for the number of corners, with cases that exactly mirror the hierarchy version:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 34</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>u32 GetCornerCountSwitch(shape_type Type)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    u32 Result = 0;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    switch(Type)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        case Shape_Square: {Result = 4;} break;</span></span>
<span class="line"><span>        case Shape_Rectangle: {Result = 4;} break;</span></span>
<span class="line"><span>        case Shape_Triangle: {Result = 3;} break;</span></span>
<span class="line"><span>        case Shape_Circle: {Result = 0;} break;</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        case Shape_Count: {} break;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>Then we compute the exact same thing as the hierarchy version:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 35</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 CornerAreaSwitch(u32 ShapeCount, shape_union *Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    for(u32 ShapeIndex = 0; ShapeIndex &lt; ShapeCount; ++ShapeIndex)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum += (1.0f / (1.0f + (f32)GetCornerCountSwitch(Shapes[ShapeIndex].Type))) * GetAreaSwitch(Shapes[ShapeIndex]);</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    return Accum;</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 CornerAreaSwitch4(u32 ShapeCount, shape_union *Shapes)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Accum0 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum1 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum2 = 0.0f;</span></span>
<span class="line"><span>    f32 Accum3 = 0.0f;</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    ShapeCount /= 4;</span></span>
<span class="line"><span>    while(ShapeCount--)</span></span>
<span class="line"><span>    {</span></span>
<span class="line"><span>        Accum0 += (1.0f / (1.0f + (f32)GetCornerCountSwitch(Shapes[0].Type))) * GetAreaSwitch(Shapes[0]);</span></span>
<span class="line"><span>        Accum1 += (1.0f / (1.0f + (f32)GetCornerCountSwitch(Shapes[1].Type))) * GetAreaSwitch(Shapes[1]);</span></span>
<span class="line"><span>        Accum2 += (1.0f / (1.0f + (f32)GetCornerCountSwitch(Shapes[2].Type))) * GetAreaSwitch(Shapes[2]);</span></span>
<span class="line"><span>        Accum3 += (1.0f / (1.0f + (f32)GetCornerCountSwitch(Shapes[3].Type))) * GetAreaSwitch(Shapes[3]);</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>        Shapes += 4;</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>    f32 Result = (Accum0 + Accum1 + Accum2 + Accum3);</span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>Just like in the total area version, the code looks almost identical between the class hierarchy implementation and the switch implementation. The only difference is whether we call a virtual function or go through a switch statement.</p><p>Moving on to the table-driven case, you can see how awesome it actually is when we fuse operations and data together! Unlike all the other versions, in this version, the <em>only</em> thing that has to change is the values in our table! We don&#39;t actually have to get secondary information about our shape — we can weld both the corner count <em>and</em> the area coefficient directly into the table, and the code <em>stays exactly the same otherwise:</em></p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/* ========================================================================</span></span>
<span class="line"><span>   LISTING 36</span></span>
<span class="line"><span>   ======================================================================== */</span></span>
<span class="line"><span></span></span>
<span class="line"><span>f32 const CTable[Shape_Count] = {1.0f / (1.0f + 4.0f), 1.0f / (1.0f + 4.0f), 0.5f / (1.0f + 3.0f), Pi32};</span></span>
<span class="line"><span>f32 GetCornerAreaUnion(shape_union Shape)</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>    f32 Result = CTable[Shape.Type]*Shape.Width*Shape.Height;</span></span>
<span class="line"><span>    return Result;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>If we run all of these “corner area” functions, we can look at how their performance is affected by the addition of the second shape property:</p><p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2Fcbb6dfeb-f038-4c3c-bfde-0cd50169fe51_1920x1080.png" alt=""></p><p>As you can see, these results are <em>even worse</em> for the “clean” code. The switch statement version, which was previously only 1.5x faster, is now nearly 2x faster, and the lookup table version is nearly <em>15x faster</em>.</p><p>This demonstrates the even deeper problem with “clean” code: the more complex you make the problem, the <em>more</em> these ideas harm your performance. When you try to scale up “clean” techniques to real objects with many properties, you will suffer these pervasive performance penalties <em>everywhere</em> in your code.</p><p>The more you use the “clean” code methodology, the less a compiler is able to see what you&#39;re doing. Everything is in separate translation units, behind virtual function calls, etc. No matter how smart the compiler is, there’s very little it can do with that kind of code.</p><p>And to make matters worse, there’s not much <em>you</em> can do with that kind of code either! As I showed before, simple things like pulling values out into a table and removing switch statements are <em>simple</em> to achieve if your codebase is architected around it’s <em>functions</em>. If instead it is architected around it’s <em>types</em>, it is much more difficult — perhaps even impossible without extensive rewrites.</p><p>So we&#39;ve gone from a 10x speed difference to a 15x speed difference just be adding one more property to our shapes. That&#39;s like pushing 2023 hardware all the way back to 2008! Instead of erasing 12 years, we&#39;re erasing <em>14 years</em> just by adding one new parameter to our definition of the problem.</p><p>That&#39;s horrible in and of itself. But you&#39;ll notice, I haven’t even mentioned optimization yet! Other than ensuring there wasn’t a loop-carried dependency, for testing purposes, I haven’t <em>optimized</em> anything!</p><p>Here&#39;s what it looks like if I run these routines against a lightly optimized AVX version of the same calculation:</p><p><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F2df69737-d8ac-43b2-954a-ea098ef8c4a2_1920x1080.png" alt=""></p><p>The speed differences range from <em>20-25x</em> — and of course, none of the AVX-optimized code uses anything remotely like “clean” code principles.</p><p>So that’s four rules down the drain. What about number five?</p><p>Honestly, “don’t repeat yourself” seems fine. As you saw from the listings, we <em>didn&#39;t</em> really repeat ourselves much. Maybe if you count the four-accumulator unrolled versions we did, but that was just for demonstration purposes. You don’t <em>actually</em> have to have both routines unless you’re doing timings like this.</p><p>If “DRY” means something more stringent — like don&#39;t build two different tables that both encode versions of the same coefficients — well then I might disagree with that sometimes, because we may have to do that for reasonable performance. But if in general “DRY” just means don&#39;t write the exact same code twice, that sounds like reasonable advice.</p><p>And most importantly, we <em>don’t</em> have to violate it to write code that gets reasonable performance.</p><p>So out of the five clean code things that actually affect code structure, I would say you have <em>one</em> you might want to think about and <em>four</em> you definitely shouldn&#39;t. Why? Because as you may have noticed, software is <em>extremely slow</em> these days. It performs <em>very, very poorly</em> compared to how fast modern hardware can actually do the things we need our software to do.</p><p>If you ask why software is slow, there are several answers. Which one is most dominant depends on the specific development environment and coding methodology.</p><p>But for a certain segment of the computing industry, the answer to “why is software so slow” is in large part “because of ‘clean’ code”. The ideas underlying the “clean” code methodology are almost all horrible for performance, and you shouldn’t do them.</p><p>The “clean” code rules were developed because someone thought they would produce more maintainable codebases. Even if that were true, you’d have to ask, “At what cost?”</p><p>It simply cannot be the case that we&#39;re willing to give up a <em>decade</em> or more of hardware performance just to make programmers’ lives a little bit easier. Our job is to write programs that run well on the hardware that we are given. If this is how bad these rules cause software to perform, they simply <em>aren&#39;t acceptable</em>.</p><p>We can still try to come up with rules of thumb that help keep code organized, easy to maintain, and easy to read. Those aren&#39;t bad goals! But these rules ain’t it. They need to stop being said unless they are accompanied by a big old asterisk that says, “and your code will get 15 times slower or more when you do them.”</p></div></div></main><footer class="VPDocFooter" data-v-bae9d5c7 data-v-a105f491><!--[--><!--]--><div class="edit-info" data-v-a105f491><!----><div class="last-updated" data-v-a105f491><p class="VPLastUpdated" data-v-a105f491 data-v-fc45ddc6>Last updated: <time datetime="2024-01-20T22:50:47.000Z" data-v-fc45ddc6></time></p></div></div><nav class="prev-next" data-v-a105f491><div class="pager" data-v-a105f491><a class="VPLink link pager-link prev" href="/tech-support-wiki/electron/typescript-get-intelliSense-for-contextBridge-api.html" data-v-a105f491><!--[--><span class="desc" data-v-a105f491>Previous page</span><span class="title" data-v-a105f491>typescript get intelliSense for contextBridge api</span><!--]--></a></div><div class="pager" data-v-a105f491><a class="VPLink link pager-link next" href="/tech-support-wiki/general/how-to-print-2-of-the-same-page-on-1-page.html" data-v-a105f491><!--[--><span class="desc" data-v-a105f491>Next page</span><span class="title" data-v-a105f491>how to print 2 of the same page on 1 page</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"webdev_html-css-site-makes-text-smaller-on-mobile.md\":\"2_P9SwEP\",\"svelte vite_svelte_vite-_lib-alias.md\":\"vbxjyZ70\",\"javascript_js-ts-add-function-to-object.md\":\"9wwt1C6j\",\"general_vivaldi-is-dimmer-when-unfocused.md\":\"JjQUMXSf\",\"electron_electron-reloader-ignore-files.md\":\"kF7QKgeF\",\"git_set-up-multiple-accounts-with-ssh-windows.md\":\"VbZkQoQi\",\"windows_windows-autochecking-disk-on-startup.md\":\"pJ0zOkbD\",\"webdev_convert-images-fonts-into-raw-css-data.md\":\"Arsm_BJV\",\"svelte vite_svelte-_-vite-publish-to-github-pages.md\":\"OKU59jaM\",\"javascript_js-method-chaining.md\":\"fVF4RGHZ\",\"electron_electron-preload-to-renderer.md\":\"IGxKuFw-\",\"general_how-to-print-2-of-the-same-page-on-1-page.md\":\"vYJWscns\",\"regex_fixed-length-palindrome.md\":\"kL0LDTQt\",\"webdev_tailwind-windows-no-bundler.md\":\"DnjmTTBg\",\"general_clean-code-horrible-performance.md\":\"ptk3eKKK\",\"windows_how to change the keyboard language shortcut in windows 10.md\":\"yocyNnDS\",\"typescript_when-to-use-record-in-typescript.md\":\"KlgBuLbm\",\"vs code_gitlens-turn-off-button-in-tabbar-toolbar.md\":\"7TqPyl2U\",\"regex_iso-date-groups.md\":\"nfDB6DDq\",\"svelte vite_svelte-each-block-but-you-care-about-key-of-object.md\":\"ljz_QkGP\",\"typescript_type-a-function-with-an-interface.md\":\"EnTpUBHz\",\"git_set-up-git-submodules.md\":\"AnwEA7FH\",\"nodejs_pnpm-link.md\":\"t9nhFgoG\",\"qmk_how-to-update-qmk.md\":\"aHR98Uvb\",\"svelte vite_vite-failing-to-load-bundles.md\":\"OxN4vKkU\",\"nodejs_esm-and-cjs-co-existence.md\":\"PF94XCh7\",\"typescript_typescript-how-to-ignore-stuff.md\":\"VfMyY42M\",\"javascript_js-locale-aware-array-sort.md\":\"ejqa_VEs\",\"svelte vite_svelte-and-vite-template.md\":\"kfedL3ZD\",\"general_how-to-tile-an-image-in-gimp.md\":\"HzNUKt8W\",\"electron_typescript-get-intellisense-for-contextbridge-api.md\":\"mtybW0-D\",\"index.md\":\"CDSyNTU0\",\"javascript_js-download-txt-filre.md\":\"KGy8P-nt\",\"typescript_typescript-thinks-svelte-is-jsx.md\":\"-l2L-ZLc\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"tech support wiki\",\"description\":\"A VitePress site\",\"base\":\"/tech-support-wiki/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"sidebar\":[{\"text\":\"electron\",\"collapsible\":true,\"items\":[{\"text\":\"electron preload to renderer\",\"link\":\"/electron/electron-preload-to-renderer\"},{\"text\":\"electron reloader ignore files\",\"link\":\"/electron/electron-reloader-ignore-files\"},{\"text\":\"typescript get intelliSense for contextBridge api\",\"link\":\"/electron/typescript-get-intelliSense-for-contextBridge-api\"}]},{\"text\":\"general\",\"collapsible\":true,\"items\":[{\"text\":\"clean code horrible performance\",\"link\":\"/general/clean-code-horrible-performance\"},{\"text\":\"how to print 2 of the same page on 1 page\",\"link\":\"/general/how-to-print-2-of-the-same-page-on-1-page\"},{\"text\":\"How to Tile an Image in GIMP\",\"link\":\"/general/How-to-Tile-an-Image-in-GIMP\"},{\"text\":\"vivaldi is dimmer when unfocused\",\"link\":\"/general/vivaldi-is-dimmer-when-unfocused\"}]},{\"text\":\"git\",\"collapsible\":true,\"items\":[{\"text\":\"set up git submodules\",\"link\":\"/git/set-up-git-submodules\"},{\"text\":\"set up multiple accounts with ssh windows\",\"link\":\"/git/set-up-multiple-accounts-with-ssh-windows\"}]},{\"text\":\"javascript\",\"collapsible\":true,\"items\":[{\"text\":\"js download txt filre\",\"link\":\"/javascript/js-download-txt-filre\"},{\"text\":\"js locale aware array sort\",\"link\":\"/javascript/js-locale-aware-array-sort\"},{\"text\":\"js method chaining\",\"link\":\"/javascript/js-method-chaining\"},{\"text\":\"js ts add function to object\",\"link\":\"/javascript/js-ts-add-function-to-object\"}]},{\"text\":\"nodejs\",\"collapsible\":true,\"items\":[{\"text\":\"esm and cjs co existence\",\"link\":\"/nodejs/esm-and-cjs-co-existence\"},{\"text\":\"pnpm link\",\"link\":\"/nodejs/pnpm-link\"}]},{\"text\":\"qmk\",\"collapsible\":true,\"items\":[{\"text\":\"how to update qmk\",\"link\":\"/qmk/how-to-update-qmk\"}]},{\"text\":\"regex\",\"collapsible\":true,\"items\":[{\"text\":\"fixed length palindrome\",\"link\":\"/regex/fixed-length-palindrome\"},{\"text\":\"ISO date groups\",\"link\":\"/regex/ISO-date-groups\"}]},{\"text\":\"svelte vite\",\"collapsible\":true,\"items\":[{\"text\":\"svelte+vite $lib alias\",\"link\":\"/svelte vite/svelte+vite-$lib-alias\"},{\"text\":\"svelte + vite publish to github pages\",\"link\":\"/svelte vite/svelte-+-vite-publish-to-github-pages\"},{\"text\":\"svelte and vite template\",\"link\":\"/svelte vite/svelte-and-vite-template\"},{\"text\":\"svelte each block but you care about key of object\",\"link\":\"/svelte vite/svelte-each-block-but-you-care-about-key-of-object\"},{\"text\":\"vite failing to load bundles\",\"link\":\"/svelte vite/vite-failing-to-load-bundles\"}]},{\"text\":\"typescript\",\"collapsible\":true,\"items\":[{\"text\":\"type a function with an interface\",\"link\":\"/typescript/type-a-function-with-an-interface\"},{\"text\":\"typescript how to ignore stuff\",\"link\":\"/typescript/typescript-how-to-ignore-stuff\"},{\"text\":\"typescript thinks svelte is jsx\",\"link\":\"/typescript/typescript-thinks-svelte-is-jsx\"},{\"text\":\"when to use Record in typescript\",\"link\":\"/typescript/when-to-use-Record-in-typescript\"}]},{\"text\":\"vs code\",\"collapsible\":true,\"items\":[{\"text\":\"gitlens turn off button in tabbar toolbar\",\"link\":\"/vs code/gitlens-turn-off-button-in-tabbar-toolbar\"}]},{\"text\":\"webdev\",\"collapsible\":true,\"items\":[{\"text\":\"convert images fonts into raw css data\",\"link\":\"/webdev/convert-images-fonts-into-raw-css-data\"},{\"text\":\"html css site makes text smaller on mobile\",\"link\":\"/webdev/html-css-site-makes-text-smaller-on-mobile\"},{\"text\":\"tailwind windows no bundler\",\"link\":\"/webdev/tailwind-windows-no-bundler\"}]},{\"text\":\"windows\",\"collapsible\":true,\"items\":[{\"text\":\"How to change the keyboard language shortcut in Windows 10\",\"link\":\"/windows/How to change the keyboard language shortcut in Windows 10\"},{\"text\":\"windows autochecking disk on startup\",\"link\":\"/windows/windows-autochecking-disk-on-startup\"}]}],\"nav\":[{\"text\":\"GitHub\",\"link\":\"https://github.com/KraXen72/tech-support-wiki\"},{\"text\":\"Ko-fi\",\"link\":\"https://ko-fi.com/kraxen72\"}],\"outline\":{\"level\":[2,6]},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>